---
import type { IndexCardsEntry } from "@/types";
import BaseLayout from "@components/base/BaseLayout.astro";
import ImageSwiper from "./ImageSwiper";
import { getCollection } from "astro:content";

interface Props {
  entry: IndexCardsEntry;
}

const { entry } = Astro.props;
const { title, description } = entry.data;

// Dynamically import all power system images
const images = import.meta.glob('/src/assets/docs/power-system/*.webp', { eager: true });

// Extract image sources and sort them numerically
const processedImages = Object.entries(images)
  .map(([path, module]) => ({
    path,
    src: (module as any).default.src,
    // Extract number from filename for sorting
    num: parseInt(path.match(/(\d+)\.webp$/)?.[1] || '0')
  }))
  .sort((a, b) => a.num - b.num)
  .map(img => img.src);

// Get power system content
const powerSystemsCollection = await getCollection("powerSystems");
const powerSystemsContent = powerSystemsCollection
  .filter(item => item.id.startsWith('system-'))
  .sort((a, b) => {
    const numA = parseInt(a.id.match(/system-(\d+)/)?.[1] || '0');
    const numB = parseInt(b.id.match(/system-(\d+)/)?.[1] || '0');
    return numA - numB;
  });

---

<BaseLayout title={title} description={description}>
  <div class="flex flex-col container">
    <div class="w-full flex-1 flex flex-col justify-center py-4 sm:py-8">
      <ImageSwiper 
        images={processedImages} 
        contents={powerSystemsContent}
        client:load
      />
    </div>
  </div>
</BaseLayout>
